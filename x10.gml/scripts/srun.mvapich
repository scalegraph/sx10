#!/bin/sh
if [ "$_" != "/usr/bin/salloc" ] ; then
    if [ "$SLURM_PROCID" == 0 ] ; then
        echo "$0" can only be run via salloc, do not run it with srun
        exit 1
    else
        exit 0
    fi
fi
export X10_HOSTFILE="hosts.$SLURM_JOB_ID"
export X10_NPLACES=$SLURM_NPROCS
export X10_SINGLE_JVM=""
srun /bin/hostname -s | sort -n > $X10_HOSTFILE
#echo $X10_NPLACES
#cat $X10_HOSTFILE
mpirun_rsh -np $X10_NPLACES -hostfile $X10_HOSTFILE $@
rc=$?
rm -f $X10_HOSTFILE
exit $rc
