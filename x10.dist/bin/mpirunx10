#!/bin/bash

#
#  This file is part of the X10 project (http://x10-lang.org).
#
#  This file is licensed to You under the Eclipse Public License (EPL);
#  You may not use this file except in compliance with the License.
#  You may obtain a copy of the License at
#      http://www.opensource.org/licenses/eclipse-1.0.php
#
#  (C) Copyright IBM Corporation 2006-2010.
#

# Use to run an X10 program linked against PGAS sockets using mpirun.
# Should work on Cygwin, Linux, Darwin, AIX
DEFAULT_PORT=21053
IP=$(host -t A $(hostname) | awk '{print $NF}')
PORT=$(expr $DEFAULT_PORT + $$ % 1024)
while netstat -an | grep tcp | grep -q "$IP.$PORT"; do
    let PORT=$PORT+1
done
mpirun -x PGASRT_HOME_PORT=$PORT "$@"
